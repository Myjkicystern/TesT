<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/png" href="my-icon.png">
<title>–ú–∏–π–∫–∏ —Ü–∏—Å—Ç–µ—Ä–Ω</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#007bff">
<style>
/* üîπ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—ñ–≥—É—á–æ–≥–æ —Ä—è–¥–∫–∞ */
.marquee-container {
  width: 100%;
  overflow: hidden;
  background: linear-gradient(90deg, #969797, #3a3cb6, #05039e);
  color: white;
  padding: 6px 0;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 7000;
  font-size: 12px;
  font-weight: bold;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

/* üîπ –í–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π –±–ª–æ–∫ –∑ —Ç–µ–∫—Å—Ç–æ–º */
.marquee-track {
  display: inline-block;
  white-space: nowrap;
  will-change: transform;
}

body {
  margin-top: 40px;
  font-family: Roboto, sans-serif;
  background: #f0f2f5;
  text-align: center;
}
body {
  margin-top: 40px;
  font-family: Roboto, sans-serif;
  background: #d1cfcf; /* —Ç–µ–º–Ω–∏–π –≥—Ä–∞—Ñ—ñ—Ç */
  color: #363636; /* —Å–≤—ñ—Ç–ª–∏–π —Ç–µ–∫—Å—Ç */
  text-align: center;
}

/* üîπ –ê–Ω—ñ–º–æ–≤–∞–Ω–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç + –ø—É–ª—å—Å—É—é—á–∏–π –µ—Ñ–µ–∫—Ç */
h1 {
  font-size: 26px;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 1px;
  background: linear-gradient(90deg, #007bff, #6f42c1, #00c6ff, #ff6ec7);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin: 5px 0 10px 0;
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

/* –ï—Ñ–µ–∫—Ç –ø–ª–∞–≤–Ω–æ—ó –ø–æ—è–≤–∏ */
@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–µ—Ä–µ–ª–∏–≤—É –≥—Ä–∞–¥—ñ—î–Ω—Ç—É */
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* –ü—É–ª—å—Å—É—é—á–∏–π —Å–≤—ñ—Ç–ª–æ–≤–∏–π –µ—Ñ–µ–∫—Ç */
@keyframes pulseGlow {
  0% { text-shadow: 0 2px 6px rgba(0,0,0,0.2), 0 0 5px rgba(255,255,255,0.3); }
  50% { text-shadow: 0 2px 6px rgba(0,0,0,0.2), 0 0 15px rgba(255,255,255,0.6); }
  100% { text-shadow: 0 2px 6px rgba(0,0,0,0.2), 0 0 5px rgba(255,255,255,0.3); }
}

/* üîπ –°—Ç–∏–ª—å–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ */
#userDisplay {
  font-size: 22px;
  font-weight: 900;
  margin: 10px 0;
  color: #111;
}


/* –ê–Ω—ñ–º–∞—Ü—ñ—è –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–æ–≥–æ –ø–µ—Ä–µ–ª–∏–≤—É */
@keyframes gradientMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* –õ–µ–≥–∫–∞ –ø—É–ª—å—Å–∞—Ü—ñ—è —Ç–∞ –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è */
@keyframes pulseScale {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* –õ–µ–≥–∫–µ –Ω–µ–æ–Ω–æ–≤–µ —Å–≤—ñ—Ç—ñ–Ω–Ω—è */
@keyframes glowEffect {
  0% { text-shadow: 0 2px 6px rgba(0,0,0,0.25), 0 0 8px rgba(255,255,255,0.3); }
  50% { text-shadow: 0 2px 6px rgba(0,0,0,0.25), 0 0 16px rgba(255,255,255,0.6); }
  100% { text-shadow: 0 2px 6px rgba(0,0,0,0.25), 0 0 8px rgba(255,255,255,0.3); }
}


#userCounter {
  position: fixed;
  top: 30px;       /* —Ç—Ä–æ—Ö–∏ –Ω–∏–∂—á–µ –±—ñ–≥—É—á–æ—ó */
  right: 2px;     /* –ø—Ä–∏—Ç–∏—Å–Ω—É—Ç–æ –≤–ø—Ä–∞–≤–æ */
  background: rgba(255, 255, 255, 0.9);
  color: #333;
  border-radius: 20px;
  padding: 3px 7px;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  z-index: 999;
  font-size: 15px;
  transition: background 0.3s;
}
#userCounter:hover {
  background: #e9f5ff;
}


h2{font-size:16px;margin:5px 0;}
p{font-size:14px;margin:5px 0;color:#0056b3;}
textarea,input{width:80%;max-width:250px;padding:6px;font-size:14px;border-radius:4px;border:1px solid #ccc;margin-bottom:5px;}
.btn{margin:3px;padding:6px 12px;font-size:14px;border-radius:6px;border:none;cursor:pointer;overflow:hidden;position:relative;}
.btn-main{display:block;width:80%;max-width:250px;margin:5px auto;padding:10px 0;background:#0088cc;color:#fff;border-radius:6px;font-size:15px;cursor:pointer;border:none;font-weight:bold;transition:all 0.3s ease;overflow:hidden;position:relative;}
.btn-main:hover{background:#005f8d;}
.like{background:#1c7430;color:#fff;font-size:16px;padding:10px 14px;}
.like:hover{background:#155d27;}
.dislike{background:#b02a37;color:#fff;font-size:16px;padding:10px 14px;}
.dislike:hover{background:#7a1c26;}
#commentsList{margin-top:5px;text-align:left;max-width:500px;margin-left:auto;margin-right:auto;}
.comment{background:#e0e0e0;padding:10px;margin-bottom:5px;border-radius:4px;position:relative;}
.comment button{margin-left:3px;padding:2px 4px;font-size:10px;cursor:pointer;}
.comment .comment-like{font-size:12px;margin-left:5px;background:#007bff;color:#fff;border:none;padding:2px 6px;border-radius:4px;cursor:pointer;}
.comment .comment-like.active-like{background:#0056b3;}
.comment .comment-time{font-size:11px;color:#555;margin-top:3px;}
.version{position:fixed;bottom:5px;left:50%;transform:translateX(-50%);font-size:10px;color:#888;background:rgba(255,255,255,0.7);padding:2px 4px;border-radius:3px;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s ease;}
.modal.show{opacity:1;pointer-events:auto;}
.modal-content{background:#fff;padding:20px 30px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.3);text-align:center;max-width:300px;animation:pop 0.3s ease;}
@keyframes pop{from{transform:scale(0.8);opacity:0;}to{transform:scale(1);opacity:1;}}
.modal-content h3{margin:0 0 10px;color:#28a745;}
.modal-content button{background:#28a745;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;}
.modal-content button:hover{background:#1e7e34;}
.active-like{background:#1e7e34 !important;}
.active-dislike{background:#a71d2a !important;}
.purple-btn{background:linear-gradient(135deg,#6f42c1,#007bff);color:#fff !important;font-weight:bold;border:none;border-radius:10px;padding:8px 14px;font-size:20px;display:inline-block;box-shadow:0 3px 8px rgba(0,0,0,0.2);transition:all 0.3s ease;}
.purple-btn:hover{background:linear-gradient(135deg,#5a32a3,#0056b3);transform:translateY(-2px) scale(1.05);box-shadow:0 5px 12px rgba(0,0,0,0.25);}
.purple-btn:active{transform:scale(0.96);box-shadow:0 2px 5px rgba(0,0,0,0.2);}
.admin-key{background:#ffc107;color:#fff;font-size:18px;padding:10px 14px;border-radius:50%;border:none;cursor:pointer;transition:transform 0.2s ease;}
.admin-key:hover{transform:scale(1.2);background:#e0a800;}
.info-icon {position: absolute; right: 6px; top: 50%; transform: translateY(-70%); cursor: pointer; width: 25px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.5s ease; box-shadow: 0 2px 6px rgba(0,0,0,0.25);}
.info-icon:hover {transform: translateY(-60%) scale(1.20); box-shadow: 0 3px 10px rgba(0,0,0,0.3);}
.user-block-btn{font-size:11px;padding:2px 6px;margin-left:5px;border:none;border-radius:4px;cursor:pointer;}
.blocked-user{opacity:0.6;}
/* Spinner */
#loadingSpinner {display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); border:6px solid #f3f3f3; border-top:6px solid #007bff; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite; z-index:6000;}
@keyframes spin {0%{transform:translate(-50%,-50%) rotate(0deg);}100%{transform:translate(-50%,-50%) rotate(360deg);}}

.title-wrap {
  position: relative;
  display: inline-block;
  margin-top: 10px;
}

.santa-hat {
  position: absolute;
  width: 55px; /* –†–æ–∑–º—ñ—Ä —à–∞–ø–∫–∏ */
  top: -13px;  /* –í–∏—Å–æ—Ç–∞ –ø—ñ–¥–π–æ–º—É –Ω–∞–¥ —Ç–µ–∫—Å—Ç–æ–º */
  left: -24px; /* –ó–º—ñ—â–µ–Ω–Ω—è –≤–ª—ñ–≤–æ/–≤–ø—Ä–∞–≤–æ */
  transform: rotate(-18deg);
  pointer-events: none;
}

.snowflake {
  position: fixed;
  top: -10px;
  color: white;
  font-size: 12px;
  pointer-events: none;
  animation: fall linear infinite;
  opacity: 0.9;
  z-index: 9000;
}

@keyframes fall {
  0% {
    transform: translateY(-10px) rotate(0deg);
  }
  100% {
    transform: translateY(110vh) rotate(360deg);
  }
}

</style>
</head>
<body>

<!-- üîπ –ë—ñ–≥—É—á–∏–π —Ä—è–¥–æ–∫ -->
<div class="marquee-container">
  <div class="marquee-track" id="marqueeTrack">
    üöß –î–æ–¥–∞—Ç–æ–∫ —Ä–æ–∑–≤–∏–≤–∞—î—Ç—å—Å—è. –ú–æ–∂–ª–∏–≤—ñ —Ç–∏–º—á–∞—Å–æ–≤—ñ –∑–º—ñ–Ω–∏ —É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—ñ, –¥–∏–∑–∞–π–Ω—ñ –∞–±–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ñ —Å—Ç–æ—Ä—ñ–Ω–æ–∫. üí°
  </div>
</div>

<div id="userCounter">
  üë• <span id="uniqueUserCount">0</span>
</div>


<div id="loadingSpinner"></div>

<div class="title-wrap">
  <h1>–ú–∏–π–∫–∏ —Ü–∏—Å—Ç–µ—Ä–Ω</h1>
  <img src="Santa.png" alt="Santa Hat" class="santa-hat">
</div>

<p> –ù–æ–≤—ñ –º–∏–π–∫–∏ –º–æ–∂–Ω–∞ –ø–∏—Å–∞—Ç–∏ –≤ –∫–æ–º–µ–Ω—Ç–∞—Ä—è—Ö —ñ –≤–æ–Ω–∏ –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –Ω–∞ –∫–∞—Ä—Ç—É.</p>

<!-- –í—Ö—ñ–¥ -->
<div id="loginSection">
  <div style="position:relative; display:inline-block; width:80%; max-width:250px; margin-bottom:5px;">
    <input type="text" id="userNameInput" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è" style="width:100%; padding-right:25px;">
    <span class="info-icon" id="infoIcon" onclick="showUserInfo()" title="–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="16" height="16">
        <circle cx="12" cy="12" r="10" fill="url(#grad)" />
        <path d="M11 10h2v7h-2zm0-4h2v2h-2z" fill="#fff"/>
        <defs>
          <linearGradient id="grad" x1="0" y1="0" x2="24" y2="24">
            <stop offset="0%" stop-color="#007bff"/>
            <stop offset="100%" stop-color="#6f42c1"/>
          </linearGradient>
        </defs>
      </svg>
    </span>
  </div>
  <button class="btn btn-main" onclick="signInAnon()">–£–≤—ñ–π—Ç–∏</button>
  <button class="admin-key" onclick="promptAdmin()" title="–í—Ö—ñ–¥ –¥–ª—è –∞–≤—Ç–æ—Ä–∞">üîë</button>
</div>

<h2 id="userDisplay" style="margin-top:10px; font-weight:bold;"></h2>
<a id="mapLink" class="purple-btn" href="#" style="display:none; margin-bottom:10px;">üó∫ –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ä—Ç–∏</a>

<h2></h2>
<button class="btn like" onclick="vote('like')" disabled id="likeBtn">üëç</button>
<button class="btn dislike" onclick="vote('dislike')" disabled id="dislikeBtn">üëé</button>
<div class="counters">–õ–∞–π–∫–∏: <span id="likeCount">0</span> | –î–∏–∑–ª–∞–π–∫–∏: <span id="dislikeCount">0</span></div>

<h2>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>
<textarea id="commentInput" rows="2" placeholder="–í–∞—à –∫–æ–º–µ–Ω—Ç–∞—Ä..." disabled></textarea><br>
<button class="btn btn-main" onclick="sendComment()" disabled>–í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏</button>
<div id="commentsList"></div>

<button id="logoutBtn" class="btn btn-main" style="background:#dc3545; display:none;" onclick="logout()">üö™ –í–∏–π—Ç–∏</button>

<!-- –°–µ–∫—Ü—ñ—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ -->
<div id="usersSection" style="display:none; margin-top:15px;">
  <h2>üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</h2>
  <div id="usersList" style="text-align:left; max-width:400px; margin:0 auto; background:#fff; padding:10px; border-radius:8px; box-shadow:0 0 6px rgba(0,0,0,0.1);"></div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ -->
<div id="successModal" class="modal">
  <div class="modal-content">
    <h3>‚úÖ –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</h3>
    <p id="modalText"></p>
    <button onclick="closeModal()">–ó–∞–∫—Ä–∏—Ç–∏</button>
  </div>
</div>


<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>

  const marquee = document.getElementById("marqueeTrack");

function startMarquee() {
  const textWidth = marquee.offsetWidth;
  const screenWidth = window.innerWidth;
  
  // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —à–≤–∏–¥–∫–æ—Å—Ç—ñ: —á–∏–º –¥–æ–≤—à–∏–π —Ç–µ–∫—Å—Ç ‚Äî —Ç–∏–º —à–≤–∏–¥—à–µ —Ä—É—Ö
  const baseSpeed = 60; // —á–∏–º –±—ñ–ª—å—à–µ —á–∏—Å–ª–æ ‚Äî —Ç–∏–º –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ
  const duration = (textWidth + screenWidth) / baseSpeed;

  // –ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è ‚Äî –ø—Ä–∞–≤–∏–π –∫—Ä–∞–π
  marquee.animate(
    [
      { transform: `translateX(${screenWidth}px)` },
      { transform: `translateX(-${textWidth}px)` }
    ],
    {
      duration: duration * 1000,
      iterations: Infinity,
      easing: "linear"
    }
  );
}

// –ó–∞–ø—É—Å–∫ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
window.addEventListener("load", startMarquee);
// –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Ä–æ–∑–º—ñ—Ä—É –µ–∫—Ä–∞–Ω–∞
window.addEventListener("resize", () => {
  marquee.getAnimations().forEach(a => a.cancel());
  startMarquee();
});

// ================= Spinner =================
function showSpinner(){document.getElementById('loadingSpinner').style.display='block';}
function hideSpinner(){document.getElementById('loadingSpinner').style.display='none';}

// ================= Firebase =================
const firebaseConfig = {
  apiKey:"AIzaSyCG5mxvBurQdQeSz6dIo-Qd5UJEwnhCxpA",
  authDomain:"miyjky.firebaseapp.com",
  databaseURL:"https://miyjky-default-rtdb.europe-west1.firebasedatabase.app",
  projectId:"miyjky",
  storageBucket:"miyjky.firebasestorage.app",
  messagingSenderId:"967414135211",
  appId:"1:967414135211:web:9b3444523a807626dbfaee"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();

let currentUserUID=null,currentUserName=null,isAdmin=false,modalTimeout,blocked=false;

// ================= Window Onload =================
window.onload=function(){
  const savedUID=localStorage.getItem('userUID');
  const savedName=localStorage.getItem('userName');
  const savedAdmin=localStorage.getItem('isAdmin')==='true';
  if(savedUID && savedName){
    currentUserUID=savedUID;
    currentUserName=savedName;
    isAdmin=savedAdmin;
    enableUI();
    checkUserVote();
    checkBlockedStatus();
    if(isAdmin) loadUsers();
  }
}

// ================= Modal =================
function showModal(msg){
  document.getElementById("modalText").innerText=msg;
  const m=document.getElementById("successModal");
  m.classList.add("show");
  clearTimeout(modalTimeout);
  modalTimeout=setTimeout(()=>closeModal(),6000);
}
function closeModal(){
  document.getElementById("successModal").classList.remove("show");
}
function showUserInfo(){
  showModal("–í–≤–µ–¥—ñ—Ç—å —Å–≤–æ—î —ñ–º'—è —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –£–≤—ñ–π—Ç–∏. –ü–æ—Ç—ñ–º –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∑–∞–ª–∏—à–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ —Ç–∞ –æ—Ü—ñ–Ω—é–≤–∞—Ç–∏ –º–∏–π–∫–∏.");
}

// ================= –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è =================
function signInAnon(){
  let name=document.getElementById('userNameInput').value.trim();
  if(!name) return showModal("–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è!");
  firebase.auth().signInAnonymously().then(res=>{
    currentUserUID=res.user.uid;
    currentUserName=name;
    isAdmin=false;
    localStorage.setItem('userUID',currentUserUID);
    localStorage.setItem('userName',name);
    localStorage.setItem('isAdmin',false);
    saveUserInDB();
    enableUI();
    checkUserVote();
    checkBlockedStatus();
    showModal("–í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫ "+name);
    document.getElementById('infoIcon').style.display='none';
  });
}

function promptAdmin(){
  const key=prompt("–í–≤–µ–¥—ñ—Ç—å –∫–ª—é—á –∞–¥–º—ñ–Ω–∞:");
  if(key!==null){
    if(key==="admin123"){
      isAdmin=true;
      firebase.auth().signInAnonymously().then(res=>{
        currentUserUID=res.user.uid;
        currentUserName="–ê–¥–º—ñ–Ω";
        localStorage.setItem('userUID',currentUserUID);
        localStorage.setItem('userName',currentUserName);
        localStorage.setItem('isAdmin',true);
        saveUserInDB();
        enableUI();
        checkUserVote();
        showModal("–í—Ö—ñ–¥ –∞–¥–º—ñ–Ω–∞ —É—Å–ø—ñ—à–Ω–∏–π!");
        document.getElementById('infoIcon').style.display='none';
        loadUsers();
      });
    } else showModal("‚ùå –ù–µ–≤—ñ—Ä–Ω–∏–π –∫–ª—é—á!");
  }
}

function logout(){
  firebase.auth().signOut().then(()=>{
    localStorage.clear();
    currentUserUID=null;
    currentUserName=null;
    isAdmin=false;
    blocked=false;
    document.getElementById('loginSection').style.display='block';
    document.getElementById('likeBtn').disabled=true;
    document.getElementById('dislikeBtn').disabled=true;
    document.querySelector('#commentInput').disabled=true;
    document.querySelector('button[onclick="sendComment()"]').disabled=true;
    document.getElementById('mapLink').style.display='none';
    document.getElementById('logoutBtn').style.display='none';
    document.getElementById('userDisplay').innerText='';
    showModal("–í–∏ –≤–∏–π—à–ª–∏ –∑ –∞–∫–∞—É–Ω—Ç—É!");
  });
}

// ================= UI =================
function enableUI(){
  if(currentUserUID && currentUserName) saveUserInDB();
  document.getElementById('likeBtn').disabled=false;
  document.getElementById('dislikeBtn').disabled=false;
  document.querySelector('#commentInput').disabled=false;
  document.querySelector('button[onclick="sendComment()"]').disabled=false;
  document.getElementById('mapLink').style.display='inline-block';
  document.getElementById('logoutBtn').style.display='inline-block';
  document.getElementById('loginSection').style.display='none';
  document.getElementById('userDisplay').innerText="–í—ñ—Ç–∞—é, "+currentUserName;
  document.getElementById('mapLink').href="map.html";
  document.getElementById('mapLink').target="_self";
  updateCounters();
  checkBlockedStatus();
}

// ================= –õ–∞–π–∫–∏/–î–∏–∑–ª–∞–π–∫–∏ =================
function updateCounters(){
  db.ref('votes').once('value').then(snap=>{
    const d=snap.val()||{likes:0,dislikes:0};
    document.getElementById('likeCount').innerText=d.likes||0;
    document.getElementById('dislikeCount').innerText=d.dislikes||0;
  });
}
function vote(type){
  if(!currentUserUID) return showModal("–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ!");
  if(blocked) return showModal("–í–∞—Å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ!");
  db.ref('votes/users/'+currentUserUID).once('value').then(snap=>{
    if(snap.exists()) return showModal("–í–∏ –≤–∂–µ –≥–æ–ª–æ—Å—É–≤–∞–ª–∏!");
    db.ref('votes/users/'+currentUserUID).set(type);
    db.ref('votes').transaction(d=>{
      if(!d)d={likes:0,dislikes:0,users:{}};
      if(type==='like')d.likes=(d.likes||0)+1;
      if(type==='dislike')d.dislikes=(d.dislikes||0)+1;
      return d;
    });
    markVoted(type);
  });
}
db.ref('votes').on('value', snap=>{
  const d=snap.val()||{likes:0,dislikes:0};
  document.getElementById('likeCount').innerText=d.likes||0;
  document.getElementById('dislikeCount').innerText=d.dislikes||0;
});
function markVoted(type){
  document.getElementById('likeBtn').classList.remove('active-like');
  document.getElementById('dislikeBtn').classList.remove('active-dislike');
  if(type==='like')document.getElementById('likeBtn').classList.add('active-like');
  if(type==='dislike')document.getElementById('dislikeBtn').classList.add('active-dislike');
}
function checkUserVote(){
  if(!currentUserUID)return;
  db.ref('votes/users/'+currentUserUID).once('value').then(s=>{
    if(s.exists())markVoted(s.val());
  });
}

// ================= –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ =================
function sendComment(){
  if(blocked)return showModal("–í–∞—Å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ!");
  const text=document.getElementById('commentInput').value.trim();
  if(!text)return showModal("–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç!");
  const comment={text,uid:currentUserUID,name:currentUserName,time:new Date().toLocaleString()};
  db.ref('comments').push(comment);
  document.getElementById('commentInput').value='';
  showModal("–ö–æ–º–µ–Ω—Ç–∞—Ä –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!");
}

// –°–ª—É—Ö–∞—î–º–æ –∑–º—ñ–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —É —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
db.ref('comments').on('value',snap=>{
  const comments=snap.val();
  const list=document.getElementById('commentsList');
  list.innerHTML='';
  for(let key in comments){
    const c=comments[key];
    const userLiked = c.likes && c.likes[currentUserUID];

    let likesText = '';
    if(c.likes){
      for(let uid in c.likes){
        likesText += `${c.likes[uid].name} (${c.likes[uid].time}) `;
      }
    }

    const div = document.createElement('div');
    div.className = 'comment' + (c.blocked ? ' blocked-user' : '');
    div.innerHTML = `
      <b>${c.name}:</b> ${c.text}
      <div class='comment-time'>${c.time || ''}</div>
      <button class="comment-like ${userLiked ? 'active-like' : ''}" onclick="likeComment('${key}')">
        üëç –õ–∞–π–∫ (${c.likesCount || 0})
      </button>
      <div style="font-size:11px; color:#333;">${likesText}</div>
    `;
    if(isAdmin){
      div.innerHTML += `
        <button class="user-block-btn" onclick="blockComment('${key}',${!c.blocked})">
          ${c.blocked?'–†–æ–∑–±–ª–æ–∫.':'–ë–ª–æ–∫.'}
        </button>
        <button class="user-block-btn" style="background:#dc3545;color:#fff;" onclick="deleteComment('${key}')">
          –í–∏–¥–∞–ª–∏—Ç–∏
        </button>
      `;
    }
    list.appendChild(div);
  }
});

// ================= –õ–∞–π–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—è =================
function likeComment(commentId){
  if(!currentUserUID) return showModal("–í–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ!");
  if(blocked) return showModal("–í–∞—Å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ!");

  const commentRef = db.ref('comments/' + commentId);
  commentRef.once('value').then(snap => {
    const c = snap.val();
    if(!c.likes) c.likes = {};
    if(c.likes[currentUserUID]) return showModal("–í–∏ –≤–∂–µ –ª–∞–π–∫–Ω—É–ª–∏ —Ü–µ–π –∫–æ–º–µ–Ω—Ç–∞—Ä!");
    c.likes[currentUserUID] = { name: currentUserName, time: new Date().toLocaleString() };
    c.likesCount = (c.likesCount || 0) + 1;
    commentRef.update({ likes: c.likes, likesCount: c.likesCount });
  });
}

// ================= –ê–¥–º—ñ–Ω =================
function blockComment(id,state){
  db.ref('comments/'+id+'/blocked').set(state);
}
function deleteComment(id){
  db.ref('comments/'+id).remove();
}
function saveUserInDB(){
  db.ref('users/'+currentUserUID).set({name:currentUserName,isAdmin,isBlocked:false});
}
function loadUsers(){
  db.ref('users').on('value',snap=>{
    const users=snap.val();
    const list=document.getElementById('usersList');
    list.innerHTML='';
    if(!users)return list.innerHTML='<p>–ù–µ–º–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</p>';
    for(let uid in users){
      const u=users[uid];
      const item=document.createElement('div');
      item.innerHTML=`${u.name||'–ë–µ–∑ —ñ–º–µ–Ω—ñ'} ${u.isBlocked?'üö´':''}
      <button class="user-block-btn" onclick="toggleBlock('${uid}',${!u.isBlocked})">${u.isBlocked?'–†–æ–∑–±–ª–æ–∫—É–≤–∞—Ç–∏':'–ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏'}</button>`;
      list.appendChild(item);
    }
    document.getElementById('usersSection').style.display='block';
  });
}
function toggleBlock(uid,state){
  db.ref('users/'+uid+'/isBlocked').set(state);
}
function checkBlockedStatus(){
  if(!currentUserUID)return;
  db.ref('users/'+currentUserUID+'/isBlocked').on('value',s=>{
    blocked=s.val()===true;
    document.getElementById('commentInput').disabled=blocked;
    document.querySelector('button[onclick="sendComment()"]').disabled=blocked;
    document.getElementById('likeBtn').disabled=blocked;
    document.getElementById('dislikeBtn').disabled=blocked;
    if(blocked) showModal("–í–∞—Å –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –∞–¥–º—ñ–Ω–æ–º!");
  });
}

// ================= –õ—ñ—á–∏–ª—å–Ω–∏–∫ —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ =================
function updateUserCount() {
  db.ref('users').on('value', snap => {
    const users = snap.val() || {};
    
    // –°—Ç–≤–æ—Ä—é—î–º–æ Set —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö —ñ–º–µ–Ω
    const uniqueNames = new Set();
    for (let uid in users) {
      const name = users[uid].name?.trim();
      if (name) uniqueNames.add(name.toLowerCase()); // —ñ–≥–Ω–æ—Ä—É—î–º–æ —Ä–µ–≥—ñ—Å—Ç—Ä
    }
    
    document.getElementById('uniqueUserCount').innerText = uniqueNames.size;
  });
}
updateUserCount();

function createSnowflake() {
  const snowflake = document.createElement('div');
  snowflake.classList.add('snowflake');
  snowflake.textContent = '‚ùÑ';

  // –í–∏–ø–∞–¥–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
  snowflake.style.left = Math.random() * 100 + 'vw';
  snowflake.style.animationDuration = 4 + Math.random() * 6 + 's';
  snowflake.style.fontSize = 10 + Math.random() * 12 + 'px';

  document.body.appendChild(snowflake);

  // –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—ñ—Å–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó
  setTimeout(() => {
    snowflake.remove();
  }, 10000);
}

// –ß–∞—Å—Ç–æ—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–Ω—ñ–∂–∏–Ω–æ–∫
setInterval(createSnowflake, 200);



</script>

<div class="version">–ë–µ—Ç–∞-–í–µ—Ä—Å—ñ—è 1.1.0</div>

</body>
</html>
